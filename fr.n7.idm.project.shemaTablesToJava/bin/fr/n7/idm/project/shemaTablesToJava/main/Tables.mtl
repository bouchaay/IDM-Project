[comment encoding = UTF-8 /]
[module Tables('http://shematables')]


[template public Tables(aTables : Tables)]
[comment @main/]
[file ('UserTableModel.java', false, 'UTF-8')]
package Main;
import ShemaTableElements.*;

public class UserTableModel {

	public static void main(String['['/]] args) {
		
			[let tables : OrderedSet(ShemaTable) = aTables.shematables]
			[for (aShemaTable : ShemaTable | tables)]
			// Catalogue de la table
			CatalogueA catalogue_[aShemaTable.id/] = new CatalogueA("[aShemaTable.catalogue.name/]");
			[let algorithmes : OrderedSet(Algorithm) = aShemaTable.catalogue.algorithms]
 			[for (algorithme : Algorithm | algorithmes)]

			// L'input de l'algorithme actuel
			[let currentAlgoInput : Input = algorithme.input]
			[if input.constante <> null]
			[let value : Constant = input.constante]
			ConstantA cons = new ConstantA([value/]);
			InputA input_[algorithme.name/]_[aShemaTable.id/] = new InputA(cons);
			[/let]
			[else]
			InputA input_[algorithme.name/]_[aShemaTable.id/] = new InputA();
			[/if]

			// Les colonnes de l'input
			[let inputCols : OrderedSet(Column) = input.columns]
			[for (currentCol : Column | inputCols)]
			[if currentCol.constraint <> null]
			ConstraintA currentColConstr_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/] = new ConstraintA("[currentCol.constraint.filePath/]");
			[else]
			ConstraintA currentColConstr_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/] = new ConstraintA("");
			[/if]
			[if currentCol.dataType = ColumnDataType::int]
			ColumnA<Integer> currentColumn_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/] = new ColumnA<Integer>("[currentCol.name/]", [currentCol.id/], ColumnDataTypeA.INTEGER, currentColConstr_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/]);
			[elseif currentCol.dataType = ColumnDataType::float]
			ColumnA<Float> currentColumn_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/] = new ColumnA<Float>("[currentCol.name/]", [currentCol.id/], ColumnDataTypeA.FLOAT, currentColConstr_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/]);
			[elseif currentCol.dataType = ColumnDataType::string]
			ColumnA<String> currentColumn_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/] = new ColumnA<String>("[currentCol.name/]", [currentCol.id/], ColumnDataTypeA.STRING, currentColConstr_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/]);
			[/if]
			input_[algorithme.name/]_[aShemaTable.id/].addColumnToInput(currentColumn_[algorithme.name/]_[aShemaTable.id/]_[currentCol.id/]);
			[/for]
			[/let]
			[/let]

			// L'output de l'algorithme
			[let currentAlgoOutput : Output = algorithme.output]
			ConstraintA outputConstr_[algorithme.name/]__[aShemaTable.id/]_[currentAlgoOutput.id/] = new ConstraintA("");
			[if currentAlgoOutput.dataType = ColumnDataType::int]
			ColumnA<Integer> currentAlgoOutput_[algorithme.name/]_[aShemaTable.id/]_[currentAlgoOutput.id/] = new ColumnA<Integer>("[currentAlgoOutput.name/]", [currentAlgoOutput.id/], ColumnDataTypeA.INTEGER, outputConstr_[algorithme.name/]__[aShemaTable.id/]_[currentAlgoOutput.id/]);
			[elseif currentAlgoOutput.dataType = ColumnDataType::float]
			ColumnA<Float> currentAlgoOutput_[algorithme.name/]_[aShemaTable.id/]_[currentAlgoOutput.id/] = new ColumnA<Float>("[currentAlgoOutput.name/]", [currentAlgoOutput.id/], ColumnDataTypeA.FLOAT, outputConstr_[algorithme.name/]__[aShemaTable.id/]_[currentAlgoOutput.id/]outputConstr);
			[elseif currentAlgoOutput.dataType = ColumnDataType::string]
			ColumnA<String> currentAlgoOutput_[algorithme.name/]_[aShemaTable.id/]_[currentAlgoOutput.id/] = new ColumnA<String>("[currentAlgoOutput.name/]", [currentAlgoOutput.id/], ColumnDataTypeA.STRING, outputConstr_[algorithme.name/]__[aShemaTable.id/]_[currentAlgoOutput.id/]);
			[/if]

			// Créer l'algorithme
			AlgorithmA currentAlgo_[algorithme.name/]_[aShemaTable.id/] = new AlgorithmA(input_[algorithme.name/]_[aShemaTable.id/], (OutputA) currentAlgoOutput_[algorithme.name/]_[aShemaTable.id/]_[currentAlgoOutput.id/], "[algorithme.name/]", "[algorithme.path/]");
			[/let]
			catalogue_[aShemaTable.id/].addAlgorithm(currentAlgo_[algorithme.name/]_[aShemaTable.id/]);
			[/for]
			[/let]
			
			// La table d'id [aShemaTable.id/]
			ShemaTableA table_[aShemaTable.id/] = new ShemaTableA("[aShemaTable.name/]", [aShemaTable.id/], catalogue_[aShemaTable.id/]);
			[let colonnes : OrderedSet(Column) = aShemaTable.columns]
 			[for (colonne : Column | colonnes)]

			// Fichier des contraintes de la colonne courante
			[if colonne.constraint <> null]
			ConstraintA contraintes_[aShemaTable.id/]_[colonne.id/] =  new ConstraintA("[colonne.constraint.filePath/]");
			[else]
			ConstraintA contraintes_[aShemaTable.id/]_[colonne.id/] =  new ConstraintA("");
			[/if]

			// Création de la colonne courante d'id [colonne.id/]
			[if colonne.dataType = ColumnDataType::int]
			ColumnA<Integer> currentColumn_[aShemaTable.id/]_[colonne.id/] = new ColumnA<Integer>("[colonne.name/]", [colonne.id/], ColumnDataTypeA.INTEGER, contraintes_[aShemaTable.id/]_[colonne.id/]);
			[elseif colonne.dataType = ColumnDataType::float]
			ColumnA<Float> currentColumn_[aShemaTable.id/]_[colonne.id/] = new ColumnA<Float>("[colonne.name/]", [colonne.id/], ColumnDataTypeA.FLOAT, contraintes_[aShemaTable.id/]_[colonne.id/]);
			[elseif colonne.dataType = ColumnDataType::string]
			ColumnA<String> currentColumn_[aShemaTable.id/]_[colonne.id/] = new ColumnA<String>("[colonne.name/]", [colonne.id/], ColumnDataTypeA.STRING, contraintes_[aShemaTable.id/]_[colonne.id/]);
			[/if]

			// Ajouter la colonne d'id [colonne.id/] à la table
			table_[aShemaTable.id/].addColumn(currentColumn_[aShemaTable.id/]_[colonne.id/]);
		[/for]
		[/let]
		[/for]
		[/let]
	}
}

[/file]
[/template]
